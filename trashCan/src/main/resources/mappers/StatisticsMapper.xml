<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.chungrim.mapper.StatisticsMapper">

	<!-- 일별 통계  View -->
	<select id="dayView" resultType="statisticsVO">
		SELECT
			DISTINCT 
			C.PLACE_NAME AS placeName,
			C.PLACE_SEQ AS placeSeq,
			SUM(A.STATISTICS_USE_NUM) AS statisticsUseNum
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		WHERE DATE(A.STATISTICS_DATE) = date(now() - interval 1 day)	
		GROUP BY DATE(A.STATISTICS_DATE), C.PLACE_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC;
	</select>
	
	<!-- 일별 통계 View 어제 최대값  -->
	<select id="dayMax" resultType="statisticsVO">
		SELECT
			SUM(A.STATISTICS_USE_NUM) AS max,
			DATE(A.STATISTICS_DATE) AS date
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		WHERE DATE(A.STATISTICS_DATE) = date(now() - interval 1 day)	
		GROUP BY DATE(A.STATISTICS_DATE), C.PLACE_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC LIMIT 1
	</select>
	
	<!-- 일별 통계 View selectBox Month -->
 	<select id="daySelectMonth" resultType="statisticsVO">
        SELECT
			DISTINCT 
			Month(A.STATISTICS_DATE) AS month
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		GROUP BY Month(A.STATISTICS_DATE), A.FK_RASPBERRYPI_IP
    </select>
    
    <!-- 일별 통계 View selectBox Day -->
 	<select id="daySelectDay" resultType="statisticsVO">
        SELECT
			DISTINCT DAY(A.STATISTICS_DATE) AS day
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		WHERE DATE(A.STATISTICS_DATE) LIKE #{month}
		GROUP BY DAY(A.STATISTICS_DATE), A.FK_RASPBERRYPI_IP
    </select>
    
    <!-- 일별 통계 View SelectBox Place -->
 	<select id="daySelectPlace" resultType="statisticsVO">
        SELECT
			DISTINCT 
			C.PLACE_NAME AS placeName,
			C.PLACE_SEQ AS placeSeq,
			SUM(A.STATISTICS_USE_NUM) AS statisticsUseNum
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date}
		GROUP BY DATE(A.STATISTICS_DATE), C.PLACE_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC
    </select>
    
    <!-- 일별 통계 View Place 최대값 -->
 	<select id="dayViewPlaceMax" resultType="statisticsVO">
        SELECT
			SUM(A.STATISTICS_USE_NUM) AS max
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date}
		GROUP BY DATE(A.STATISTICS_DATE), C.PLACE_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC LIMIT 1
    </select>
    
    <!-- 일별 통계 View SelectBox Detail -->
 	<select id="daySelectDetail" resultType="statisticsVO">
		SELECT
			DISTINCT 
			D.DETAIL_NAME AS detailName,
			D.DETAIL_SEQ AS detailSeq,
			SUM(A.STATISTICS_USE_NUM) AS statisticsUseNum
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} AND C.PLACE_SEQ = #{placeSeq}
		GROUP BY DATE(A.STATISTICS_DATE), D.DETAIL_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC
	</select>
	
	<!-- 일별 통계 View Detail 최대값 -->
 	<select id="dayViewDetailMax" resultType="statisticsVO">
		SELECT
			SUM(A.STATISTICS_USE_NUM) AS max
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} AND C.PLACE_SEQ = #{placeSeq}
		GROUP BY DATE(A.STATISTICS_DATE), D.DETAIL_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC limit 1
	</select>
	
	<!-- 일별 통계 View SelectBox Floor -->
 	<select id="daySelectFloor" resultType="statisticsVO">
		SELECT
			DISTINCT 
			E.FLOOR_NAME AS floorName,
			E.FLOOR_SEQ AS floorSeq,
			SUM(A.STATISTICS_USE_NUM) AS statisticsUseNum
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		JOIN FLOOR E
			ON B.FK_FLOOR_SEQ = E.FLOOR_SEQ
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} 
			AND C.PLACE_SEQ = #{placeSeq} 
			AND D.DETAIL_SEQ = #{detailSeq}
		GROUP BY DATE(A.STATISTICS_DATE), E.FLOOR_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC
	</select>
	
	<!-- 일별 통계 View Floor 최대값 -->
 	<select id="dayViewFloorMax" resultType="statisticsVO">
		SELECT
			SUM(A.STATISTICS_USE_NUM) AS max
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		JOIN FLOOR E
			ON B.FK_FLOOR_SEQ = E.FLOOR_SEQ
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} 
			AND C.PLACE_SEQ = #{placeSeq} 
			AND D.DETAIL_SEQ = #{detailSeq}
		GROUP BY DATE(A.STATISTICS_DATE), E.FLOOR_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC LIMIT 1
	</select>
	
	<!-- 일별 통계 View SelectBox Gender -->
 	<select id="daySelectGender" resultType="statisticsVO">
		SELECT
			DISTINCT 
			F.GENDER_NAME AS genderName,
			F.GENDER_NUM AS genderNum,
			SUM(A.STATISTICS_USE_NUM) AS statisticsUseNum
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		JOIN FLOOR E
			ON B.FK_FLOOR_SEQ = E.FLOOR_SEQ
		JOIN GENDER F
			ON B.FK_GENDER_NUM = F.GENDER_NUM
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} 
			AND C.PLACE_SEQ = #{placeSeq} 
			AND D.DETAIL_SEQ = #{detailSeq}
			AND E.FLOOR_SEQ = #{floorSeq}
		GROUP BY DATE(A.STATISTICS_DATE), F.GENDER_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC
	</select>
	
	<!-- 일별 통계 View Gender 최대값 -->
 	<select id="dayViewGenderMax" resultType="statisticsVO">
		SELECT
			SUM(A.STATISTICS_USE_NUM) AS max
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		JOIN FLOOR E
			ON B.FK_FLOOR_SEQ = E.FLOOR_SEQ
		JOIN GENDER F
			ON B.FK_GENDER_NUM = F.GENDER_NUM
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} 
			AND C.PLACE_SEQ = #{placeSeq} 
			AND D.DETAIL_SEQ = #{detailSeq}
			AND E.FLOOR_SEQ = #{floorSeq}
		GROUP BY DATE(A.STATISTICS_DATE), F.GENDER_NAME
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC LIMIT 1
	</select>
	
	<!-- 일별 통계 View All -->
 	<select id="daySelectAll" resultType="statisticsVO">
		SELECT
			DISTINCT 
			B.RASPBERRYPI_IP AS raspberrypiIp,
			SUM(A.STATISTICS_USE_NUM) AS statisticsUseNum
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		JOIN FLOOR E
			ON B.FK_FLOOR_SEQ = E.FLOOR_SEQ
		JOIN GENDER F
			ON B.FK_GENDER_NUM = F.GENDER_NUM
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} 
			AND C.PLACE_SEQ = #{placeSeq} 
			AND D.DETAIL_SEQ = #{detailSeq}
			AND E.FLOOR_SEQ = #{floorSeq}
			AND F.GENDER_NUM = #{genderNum}
		GROUP BY DATE(A.STATISTICS_DATE), B.RASPBERRYPI_IP
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC
	</select>
	
	<!-- 일별 통계 View ALL 최대값 -->
 	<select id="dayViewAllMax" resultType="statisticsVO">
		SELECT
			SUM(A.STATISTICS_USE_NUM) AS max
		FROM
			STATISTICS A
		JOIN RASPBERRYPI B
			ON A.FK_RASPBERRYPI_IP = B.RASPBERRYPI_IP
		JOIN PLACE C
			ON B.FK_PLACE_SEQ = C.PLACE_SEQ
		JOIN DETAIL D
			ON B.FK_DETAIL_SEQ = D.DETAIL_SEQ
		JOIN FLOOR E
			ON B.FK_FLOOR_SEQ = E.FLOOR_SEQ
		JOIN GENDER F
			ON B.FK_GENDER_NUM = F.GENDER_NUM
		WHERE DATE(A.STATISTICS_DATE) LIKE #{date} 
			AND C.PLACE_SEQ = #{placeSeq} 
			AND D.DETAIL_SEQ = #{detailSeq}
			AND E.FLOOR_SEQ = #{floorSeq}
			AND F.GENDER_NUM = #{genderNum}
		GROUP BY DATE(A.STATISTICS_DATE), B.RASPBERRYPI_IP
		ORDER BY SUM(A.STATISTICS_USE_NUM) DESC LIMIT 1
	</select>
</mapper>