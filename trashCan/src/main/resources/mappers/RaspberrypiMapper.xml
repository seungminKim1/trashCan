<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.chungrim.mapper.RaspberrypiMapper">
 
 	<!-- place 가져오기 -->
 	<select id="placeList" resultType="piVO">
        SELECT
        	PLACE_NAME AS placeName,
        	PLACE_SEQ AS placeSeq
        FROM
        	PLACE
    </select>
    
    <!-- detail 가져오기 -->
 	<select id="detailList" resultType="piVO">
        SELECT
        	DETAIL_NAME AS detailName,
        	DETAIL_SEQ AS detailSeq
        FROM
        	DETAIL
        WHERE
        	FK_PLACE_SEQ = #{fkPlaceSeq}
    </select>
    
    <!-- floor 가져오기 -->
 	<select id="floorList" resultType="piVO">
        SELECT
        	FLOOR_NAME AS floorName,
        	FLOOR_SEQ AS floorSeq
        FROM
        	FLOOR
    </select>
    
    <!-- gender 가져오기 -->
 	<select id="genderList" resultType="piVO">
        SELECT
        	GENDER_NAME AS genderName,
        	GENDER_NUM AS genderNum
        FROM
        	GENDER
    </select>
    
    <!-- 라즈베리파이 등록하기 -->
 	<insert id="insertRaspberrypi" parameterType="piVO" > 
 		INSERT INTO 
 			RASPBERRYPI (
	 			RASPBERRYPI_IP,
	 			FK_PLACE_SEQ,
	 			FK_DETAIL_SEQ,
	 			FK_FLOOR_SEQ,
	 			FK_GENDER_NUM
 			) VALUES (
 				#{raspberrypiIp}, 
 				#{placeSeq}, 
 				#{detailSeq}, 
 				#{floorSeq}, 
 				#{genderNum}
 			)
 	</insert>
 	
 	<!-- 라즈베리파이 리스트 가져오기 -->
 	<select id="piList" resultType="piVO">
        select
			A.RASPBERRYPI_IP AS raspberrypiIp,
			A.RASPBERRYPI_STATUS AS raspberrypiStatus,
		    B.PLACE_NAME AS placeName,
		    C.DETAIL_NAME AS detailName,
		    D.FLOOR_NAME AS floorName,
			E.GENDER_NAME AS genderName 
		from
			RASPBERRYPI A
		join PLACE B
			ON A.FK_PLACE_SEQ = B.PLACE_SEQ
		JOIN DETAIL C
			ON A.FK_DETAIL_SEQ = C.DETAIL_SEQ
		JOIN FLOOR D
			ON A.FK_FLOOR_SEQ = D.FLOOR_SEQ
		JOIN GENDER E
			ON A.FK_GENDER_NUM = E.GENDER_NUM
    </select>
 	
 	<!-- 라즈베리파이 정보 가져오기 -->
 	<select id="piInfomaion" resultType="piVO">
        select
			A.RASPBERRYPI_IP AS raspberrypiIp,
			A.RASPBERRYPI_STATUS AS raspberrypiStatus,
		    B.PLACE_NAME AS placeName,
		    C.DETAIL_NAME AS detailName,
		    D.FLOOR_NAME AS floorName,
			E.GENDER_NAME AS genderName 
		from
			RASPBERRYPI A
		join PLACE B
			ON A.FK_PLACE_SEQ = B.PLACE_SEQ
		JOIN DETAIL C
			ON A.FK_DETAIL_SEQ = C.DETAIL_SEQ
		JOIN FLOOR D
			ON A.FK_FLOOR_SEQ = D.FLOOR_SEQ
		JOIN GENDER E
			ON A.FK_GENDER_NUM = E.GENDER_NUM
		WHERE
			RASPBERRYPI_IP = #{ip}
    </select>
    
    <!-- 라즈베리파이 상태 값 변경 -->
    <update id="updateRaspberrypi" parameterType="piVO">
    	UPDATE 
    		RASPBERRYPI 
    	SET  
    		RASPBERRYPI_STATUS = #{raspberrypiStatus}
    	WHERE
    		RASPBERRYPI_IP = #{raspberrypiIp}
    </update>
</mapper>